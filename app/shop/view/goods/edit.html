<!doctype html>
<html>
<head>
<meta charset="utf-8">
<link rel="stylesheet" href="__CSS__/base.css" />
<link rel="stylesheet" href="__CSS__/info-reg.css" />
<title>商城后台</title>
<style type='text/css'>
	select {
		background: rgba(0, 0, 0, 0) url("__IMAGES__/inputbg.png") repeat-x scroll 0 0;
	    border: 1px solid #c5d6e0;
	    height: 28px;
	    outline: medium none;
	    padding: 0 8px;
	    width: 240px;
	}
	.main p input {
		float:none;
	}
	.selBtn{
		float: left;
		margin-right: 7px;
		text-align: center;
		border: none;
		border-radius: 2px;
		font-size: 14px;
		width: 88px;
		height: 33px;
		line-height: 33px;
		background: #68b86c;
		color: #fff;
	}
	.inBtn{
		background: #eee;
		color: #000;
	}
	.showImg{
		float: left;
		width: 100px;
		height: 140px;
		margin: 0 5px;
	}
</style>
</head>

<body>
<div class="title"><h2>商品信息编辑</h2></div>
<div id='tabbar' class='table-operate ue-clear'>
	<a href="javascript:;" class="selBtn">通用信息</a>
	<a href="javascript:;" class="selBtn inBtn">商品属性</a>
	<a href="javascript:;" class="selBtn inBtn">商品图片</a>
</div>
<form action="" method="post" enctype="multipart/form-data">
<div class="main">
	<p class="short-input ue-clear">
		<label>商品名称：</label>
		<input name="id" type="hidden" value="{$info.id}"/>
		<input name="goods_name" type="text" placeholder="商品名称..." value="{$info.goods_name}"/>
	</p>
	<p class="short-input ue-clear">
		<label>商品货号：</label>
		<input name="goods_sn" type="text" placeholder="商品货号..." value="{$info.goods_sn}"/><span style="color: red; position: absolute; left: 370px;">*若不输入货号则系统自动生成</span>
	</p>
	<p class="short-input ue-clear">
    	<label>促销价格：</label>
		<input name="cx_price" type="text" placeholder="促销价格..." value="{$info.cx_price}"/>
		<input name="start" type="text" placeholder="开始时间y-m-d h:i:s..." value="{$info.start|date='Y-m-d H:i:s', ###}"/>
		<input name="end" type="text" placeholder="结束时间y-m-d h:i:s..." value="{$info.end|date='Y-m-d H:i:s', ###}"/>
	</p>
	<div class="short-input select ue-clear">
		<label>分类：</label>
		<div class="select-wrap">
			<select name="cate_id">
				<option value="0">请选择</option>
				{volist name='cate' id='vo'}
				<option value="{$vo.id}" {eq name='vo.id' value="$info.cate_id"}selected='selected'{/eq} >|{$vo.level|str_repeat='--',###}{$vo.cname}</option>
				{/volist}
			</select>
		</div>
	</div>
	<div class="short-input select ue-clear">
		<label>扩展分类：</label>
		<input type="button" name="addExtCate" id="addExtCate" value="增加扩展分类"/>
		{volist name='ext_cate' id='vol'}
		<div class="select-wrap">
			<select name="goods_cate[]">
				<option value="0">请选择</option>
				{volist name='cate' id='vo'}
				<option value="{$vo.id}" {eq name='vo.id' value="$vol.cate_id"}selected='selected'{/eq}  >|{$vo.level|str_repeat='--',###}{$vo.cname}</option>
				{/volist}
			</select>
		</div>
		{/volist}
	</div>
	<p class="short-input ue-clear">
		<label>市场售价：</label>
		<input name="market_price" type="text" value="{$info.market_price}"/>
	</p>
	<p class="short-input ue-clear">
		<label>本店售价：</label>
		<input name="shop_price" type="text" value="{$info.shop_price}"/>
	</p>
	<p class="short-input ue-clear">
		<label>附件：</label>
		<input name="image" type="file"/>
	</p>
	<p class="short-input ue-clear">
		<label>加入推荐：</label>
		<input type="checkbox" name="is_hot" value="1" {eq name='$info.is_hot' value="1"}checked='checked'{/eq} />热卖
		<input type="checkbox" name="is_rec" value="1" {eq name='$info.is_rec' value="1"}checked='checked'{/eq} />推荐
		<input type="checkbox" name="is_now" value="1" {eq name='$info.is_now' value="1"}checked='checked'{/eq} />新品
	</p>
	<p class="short-input ue-clear">
		<label>是否销售：</label>
		<input type="radio" name="is_sale" value="0" {eq name='$info.is_sale' value="0"}checked='checked'{/eq} />否
		<input type="radio" name="is_sale" value="1" {eq name='$info.is_sale' value="1"}checked='checked'{/eq} />是
	</p>
	<p class="short-input ue-clear">
		<label>内容：<script id="editor" type="text/plain" style="width:800px;height:400px;" name='goods_body'>{$info.goods_body}</script></label>
	</p>
</div>
<div class="main" style="display: none;">
	<div class="short-input select ue-clear">
		<label>类型名称：</label>
		<div class="select-wrap">
			<select name="type_id">
				<option value="0">请选择</option>
				{volist name='type' id='vo'}
				<option value="{$vo.id}" {eq name='info.type_id' value="$vo.id"}selected='selected'{/eq} >{$vo.type_name}</option>
				{/volist}
			</select>
		</div>
	</div>
	<div id="showAttr">
	{volist name='attr' id='v'}
		{volist name='v' id='vol'}
			{eq name='vol.attr_input_type' value='1'}
			<p class="short-input ue-clear">
				<label>{$vol.attr_name}：</label>
				<input name="attr[{$vol.attr_id}][]" type="text" placeholder="{$vol.attr_name}..." value="{$vol.attr_values}"/>
			</p>
			{else/}
			<div class="short-input select ue-clear">
				<label>{eq name='vol.attr_type' value='2'}<a href="javascript:;" onclick="cloneSelf(this)">{eq name='i' value="1"}[+]{else/}[-]{/eq}</a>{/eq}{$vol.attr_name}：</label>
				<div class="select-wrap">
					<select name="attr[{$vol.attr_id}][]">
						{volist name='vol.attr_value' id='vo'}
						<option {eq name='vol.attr_values' value="$vo"}selected='selected'{/eq} >{$vo}</option>
						{/volist}
					</select>
				</div>
			</div>
			{/eq}
		{/volist}
	{/volist}
	</div>
</div>
<div class="main pic" style="display: none;">
	<div class="short-input ue-clear">
		{volist name='img' id='vo'}
		<div class='showImg'>
			<img src="\{$vo.goods_thumb}" alt="" data-id="{$vo.id}" width="100" height="100"><br>
			<input type="button" name="" class="delImg" value="删除"/><br>
		</div>
		{/volist}
	</div>
	<p class="short-input ue-clear">
		<input type="button" name="addImg" id="addImg" value="增加图片"/>
	</p>
	<p class="short-input ue-clear">
    	<label>图片选择：</label>
        <input name="pic[]" type="file" />
	</p>
</div>
<div class="btn ue-clear">
	<a href="javascript:;" class="confirm" id='btnSubmit'>确定</a>
    <a href="javascript:;" class="clear" id='btnReset'>清空内容</a>
</div>
</form>
</body>
<script type="text/javascript" src="__JS__/jquery.js"></script>
<script type="text/javascript" src="__JS__/common.js"></script>
<script type="text/javascript" src="__JS__/WdatePicker.js"></script>
<script type="text/javascript" src="__PUBLIC__/ueditor/ueditor.config.js"></script>
<script type="text/javascript" src="__PUBLIC__/ueditor/ueditor.all.min.js"></script>
<script type="text/javascript" src="__PUBLIC__/ueditor/lang/zh-cn/zh-cn.js"></script>

<script type="text/javascript">

	let ue = UE.getEditor('editor');

$(function(){
	$('#btnSubmit').on('click',function(){
		$('form').submit();
	});
	
	$('#btnReset').on('click',function(){
		$('form')[0].reset();
	});
});	

$(".select-title").on("click",function(){
	$(".select-list").toggle();
	return false;
});
$(".select-list").on("click","li",function(){
	var txt = $(this).text();
	$(".select-title").find("span").text(txt);
});
showRemind('input[type=text], textarea','placeholder');

// jQuery代码
$(function(){
	$('#addExtCate').on('click', function(){
		var obj = $(this).next().clone();
		$(this).parent().append(obj);
	});

	// 实现切换按钮
	$('#tabbar a').on('click', function(){
		let i = $(this).index();
		$('.main').hide();
		$('.main').eq(i).show();
		$('.selBtn').addClass('inBtn');
		$('.selBtn').eq(i).removeClass('inBtn');
	});

	// ajax请求类型属性
	$("select[name='type_id']").on('change', function(){
		let type_id = $(this).val();
		$.ajax({
			type: "post",
			url: "{:url('showAttr')}",
			data: {type_id: type_id},
			success: function (response) {
				$('#showAttr').html(response);
			}
		});
	});

	// 增加图片选择
	$('#addImg').on('click', function(){
		let current = $(this).parent().next().clone();
		$('.pic').append(current);
	});

	// 删除图片
	$('.delImg').on('click', function(){
		let img_id = $(this).prev().prev().attr('data-id');
		let obj = $(this).parent();
		$.ajax({
			type: "post",
			url: "{:url('delImg')}",
			data: {img_id: img_id},
			success: function (response) {
				if(response.state == 1){
					obj.remove();
					alert('aaaaa');
				}
			}
		});
	});
});
// 实现商品属性单选的添加删减功能
function cloneSelf(obj){
	let current = $(obj).parent().parent();
	if($(obj).html() == '[+]'){
		let newDiv = current.clone();
		newDiv.find('a').html('[-]');
		current.after(newDiv);
	}else{
		current.remove();
	}
}
</script>
</html>
